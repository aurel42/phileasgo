=== RUN   TestEssayHandler_SelectTopic
2026/01/27 17:54:06 INFO EssayHandler: Topic pool exhausted. Starting new rotation cycle. topics=3
2026/01/27 17:54:06 INFO EssayHandler: Topic pool exhausted. Starting new rotation cycle. topics=3
--- PASS: TestEssayHandler_SelectTopic (0.00s)
=== RUN   TestEssayHandler_BuildPrompt
--- PASS: TestEssayHandler_BuildPrompt (0.01s)
=== RUN   TestEssayHandler_BuildPrompt_CoordinatesPassthrough
--- PASS: TestEssayHandler_BuildPrompt_CoordinatesPassthrough (0.00s)
=== RUN   TestNewEssayHandler_NotFound
--- PASS: TestNewEssayHandler_NotFound (0.00s)
=== RUN   TestSelectTopic_EmptyConfig
--- PASS: TestSelectTopic_EmptyConfig (0.00s)
=== RUN   TestNewLLMProvider
=== RUN   TestNewLLMProvider/Gemini_Provider
2026/01/27 17:54:06 WARN Gemini model validation failed (proceeding due to TEST_MODE) error="no profiles configured for gemini provider"
=== RUN   TestNewLLMProvider/Unknown_Provider
--- PASS: TestNewLLMProvider (0.00s)
    --- PASS: TestNewLLMProvider/Gemini_Provider (0.00s)
    --- PASS: TestNewLLMProvider/Unknown_Provider (0.00s)
=== RUN   TestNewTTSProvider
=== RUN   TestNewTTSProvider/SAPI_Provider
=== RUN   TestNewTTSProvider/Edge_TTS_Provider
=== RUN   TestNewTTSProvider/Fish_Audio_Provider
=== RUN   TestNewTTSProvider/Azure_Speech_Provider
=== RUN   TestNewTTSProvider/Unknown_Provider
--- PASS: TestNewTTSProvider (0.00s)
    --- PASS: TestNewTTSProvider/SAPI_Provider (0.00s)
    --- PASS: TestNewTTSProvider/Edge_TTS_Provider (0.00s)
    --- PASS: TestNewTTSProvider/Fish_Audio_Provider (0.00s)
    --- PASS: TestNewTTSProvider/Azure_Speech_Provider (0.00s)
    --- PASS: TestNewTTSProvider/Unknown_Provider (0.00s)
=== RUN   TestLatencyTracking
--- PASS: TestLatencyTracking (0.00s)
=== RUN   TestSampleNarrationLength_RelativeDominance
    length_test.go:103: High Comp Avg: 100.00
    length_test.go:104: Low Comp Avg: 200.00
--- PASS: TestSampleNarrationLength_RelativeDominance (0.00s)
=== RUN   TestSampleNarrationLength_Multipliers
=== RUN   TestSampleNarrationLength_Multipliers/Default_(1)_-_Short_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Default_(1)_-_Long_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Medium_(3)_-_x1.5_-_Short_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Medium_(3)_-_x1.5_-_Long_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Max_(5)_-_x2.0_-_Short_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Max_(5)_-_x2.0_-_Long_Skew
=== RUN   TestSampleNarrationLength_Multipliers/Clamped_Max_(>5)
--- PASS: TestSampleNarrationLength_Multipliers (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Default_(1)_-_Short_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Default_(1)_-_Long_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Medium_(3)_-_x1.5_-_Short_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Medium_(3)_-_x1.5_-_Long_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Max_(5)_-_x2.0_-_Short_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Max_(5)_-_x2.0_-_Long_Skew (0.00s)
    --- PASS: TestSampleNarrationLength_Multipliers/Clamped_Max_(>5) (0.00s)
=== RUN   TestAIService_ReplayLast
=== RUN   TestAIService_ReplayLast/Replay_last_POI_success
2026/01/27 17:54:06 INFO Narrator: Replaying last POI title="Test POI"
=== RUN   TestAIService_ReplayLast/Replay_last_Essay_success
2026/01/27 17:54:06 INFO Narrator: Replaying last Essay title="Great History"
=== RUN   TestAIService_ReplayLast/Audio_replay_fails
=== RUN   TestAIService_ReplayLast/Replay_with_no_state_(fallback)
2026/01/27 17:54:06 WARN Narrator: Replaying audio but no state to restore
--- PASS: TestAIService_ReplayLast (0.00s)
    --- PASS: TestAIService_ReplayLast/Replay_last_POI_success (0.00s)
    --- PASS: TestAIService_ReplayLast/Replay_last_Essay_success (0.00s)
    --- PASS: TestAIService_ReplayLast/Audio_replay_fails (0.00s)
    --- PASS: TestAIService_ReplayLast/Replay_with_no_state_(fallback) (0.00s)
=== RUN   TestSampleNarrationLength
--- PASS: TestSampleNarrationLength (0.00s)
=== RUN   TestSampleNarrationLength_EdgeCases
--- PASS: TestSampleNarrationLength_EdgeCases (0.00s)
=== RUN   TestAIService_PlayBorder
2026/01/27 17:54:06 INFO AI Narrator service started
2026/01/27 17:54:06 INFO Narrator: Border announcement requested from=France to=Germany
2026/01/27 17:54:06 INFO GenerationQueue: Enqueued job type=border poi_id="" queue_len=1
2026/01/27 17:54:06 INFO PlaybackQueue: Enqueued narrative title="Border Crossing" priority=true queue_len=1
2026/01/27 17:54:06 INFO Narrator: Narration stats type=border name="Border Crossing" id=border requested_len=30 words=2 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=1
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=2
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=3
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=4
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=5
2026/01/27 17:54:07 INFO Narrator: Border announcement skipped (queue constraints)
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=poi poi_id="" queue_len=1
2026/01/27 17:54:07 INFO Narrator: Border announcement skipped (priority jobs pending)
--- PASS: TestAIService_PlayBorder (0.10s)
=== RUN   TestAIService_HandleTTSError
2026/01/27 17:54:07 ERROR Narrator: TTS synthesis failed error="rate limited"
2026/01/27 17:54:07 WARN Narrator: Activating edge-tts fallback for this session
2026/01/27 17:54:07 WARN Narrator: Skipping current POI (script incompatible with fallback TTS). Will retry with next POI.
--- PASS: TestAIService_HandleTTSError (0.00s)
=== RUN   TestBuildPromptData
=== RUN   TestBuildPromptData/Last_Sentence_Injection
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=metric error="template: no template \"units/metric.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
=== RUN   TestBuildPromptData/Happy_Path
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=metric error="template: no template \"units/metric.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
=== RUN   TestBuildPromptData/Language_Parsing
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=metric error="template: no template \"units/metric.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
--- PASS: TestBuildPromptData (0.00s)
    --- PASS: TestBuildPromptData/Last_Sentence_Injection (0.00s)
    --- PASS: TestBuildPromptData/Happy_Path (0.00s)
    --- PASS: TestBuildPromptData/Language_Parsing (0.00s)
=== RUN   TestFetchWikipediaText
=== RUN   TestFetchWikipediaText/In_Store
=== RUN   TestFetchWikipediaText/Fetch_Success
=== RUN   TestFetchWikipediaText/Bad_URL
=== RUN   TestFetchWikipediaText/Fetch_Error
2026/01/27 17:54:07 WARN Narrator: Failed to fetch Wikipedia HTML title=Baz error=fail
--- PASS: TestFetchWikipediaText (0.00s)
    --- PASS: TestFetchWikipediaText/In_Store (0.00s)
    --- PASS: TestFetchWikipediaText/Fetch_Success (0.00s)
    --- PASS: TestFetchWikipediaText/Bad_URL (0.00s)
    --- PASS: TestFetchWikipediaText/Fetch_Error (0.00s)
=== RUN   TestFetchRecentContext
=== RUN   TestFetchRecentContext/None_nearby
=== RUN   TestFetchRecentContext/One_nearby
=== RUN   TestFetchRecentContext/Empty
--- PASS: TestFetchRecentContext (0.00s)
    --- PASS: TestFetchRecentContext/None_nearby (0.00s)
    --- PASS: TestFetchRecentContext/One_nearby (0.00s)
    --- PASS: TestFetchRecentContext/Empty (0.00s)
=== RUN   TestSampleNarrationLength_Logic
=== RUN   TestSampleNarrationLength_Logic/Many_Rivals
=== RUN   TestSampleNarrationLength_Logic/Lone_Wolf
--- PASS: TestSampleNarrationLength_Logic (0.00s)
    --- PASS: TestSampleNarrationLength_Logic/Many_Rivals (0.00s)
    --- PASS: TestSampleNarrationLength_Logic/Lone_Wolf (0.00s)
=== RUN   TestTripSummary
--- PASS: TestTripSummary (0.00s)
=== RUN   TestPlayDebrief
2026/01/27 17:54:07 INFO Narrator: Generating Landing Debrief...
--- PASS: TestPlayDebrief (0.00s)
=== RUN   TestPlayDebrief_Disabled
--- PASS: TestPlayDebrief_Disabled (0.00s)
=== RUN   TestPlayDebrief_Busy
2026/01/27 17:54:07 INFO Narrator: Debrief requested but trip summary is too short. length=0
--- PASS: TestPlayDebrief_Busy (0.00s)
=== RUN   TestPlayDebrief_ShortSummary
2026/01/27 17:54:07 INFO Narrator: Debrief requested but trip summary is too short. length=0
--- PASS: TestPlayDebrief_ShortSummary (0.00s)
2026/01/27 17:54:07 INFO Narrator: Generating Debrief max_words=100
=== RUN   TestPlayDebrief_PendingGeneration
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title=Debrief priority=true queue_len=1
2026/01/27 17:54:07 INFO Narrator: Narration stats type=debrief name=Debrief id=debrief requested_len=100 words=7 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=poi poi_id="" queue_len=1
2026/01/27 17:54:07 INFO Narrator: Debrief skipped (priority jobs pending)
--- PASS: TestPlayDebrief_PendingGeneration (0.00s)
=== RUN   TestAIService_PlayEssay
=== RUN   TestAIService_PlayEssay/Happy_Path
2026/01/27 17:54:07 INFO AI Narrator service started
2026/01/27 17:54:07 INFO Narrator: Triggering Essay
2026/01/27 17:54:07 INFO EssayHandler: Topic pool exhausted. Starting new rotation cycle. topics=1
2026/01/27 17:54:07 INFO Narrator: Narrating Essay topic="History of Flight"
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=1
2026/01/27 17:54:07 INFO Narrator: Narration stats type=essay name="Essay: History of Flight" id=essay requested_len=50 words=2 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
=== RUN   TestAIService_PlayEssay/LLM_Error
2026/01/27 17:54:07 INFO AI Narrator service started
2026/01/27 17:54:07 INFO Narrator: Triggering Essay
2026/01/27 17:54:07 INFO EssayHandler: Topic pool exhausted. Starting new rotation cycle. topics=1
2026/01/27 17:54:07 INFO Narrator: Narrating Essay topic="History of Flight"
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 ERROR Narrator: Essay generation failed error="LLM generation failed: llm fail"
--- PASS: TestAIService_PlayEssay (0.20s)
    --- PASS: TestAIService_PlayEssay/Happy_Path (0.10s)
    --- PASS: TestAIService_PlayEssay/LLM_Error (0.10s)
=== RUN   TestAIService_PlayEssay_NoHandler
--- PASS: TestAIService_PlayEssay_NoHandler (0.00s)
=== RUN   TestAIService_GenerateNarrative_ProfileAndWords
=== RUN   TestAIService_GenerateNarrative_ProfileAndWords/POI_Narration_-_Uses_narration_profile
=== RUN   TestAIService_GenerateNarrative_ProfileAndWords/Screenshot_Analysis_-_Uses_screenshot_profile_and_image
=== RUN   TestAIService_GenerateNarrative_ProfileAndWords/Regional_Essay_-_Uses_essay_profile
=== RUN   TestAIService_GenerateNarrative_ProfileAndWords/Flight_Debrief_-_Uses_debrief_profile
--- PASS: TestAIService_GenerateNarrative_ProfileAndWords (0.00s)
    --- PASS: TestAIService_GenerateNarrative_ProfileAndWords/POI_Narration_-_Uses_narration_profile (0.00s)
    --- PASS: TestAIService_GenerateNarrative_ProfileAndWords/Screenshot_Analysis_-_Uses_screenshot_profile_and_image (0.00s)
    --- PASS: TestAIService_GenerateNarrative_ProfileAndWords/Regional_Essay_-_Uses_essay_profile (0.00s)
    --- PASS: TestAIService_GenerateNarrative_ProfileAndWords/Flight_Debrief_-_Uses_debrief_profile (0.00s)
=== RUN   TestAIService_GenerateNarrative_RescueAvoidance
=== RUN   TestAIService_GenerateNarrative_RescueAvoidance/No_Rescue_when_within_buffer
=== RUN   TestAIService_GenerateNarrative_RescueAvoidance/Rescue_triggered_when_significantly_over
2026/01/27 17:54:07 WARN Narrator: Script exceeded limit, attempting rescue requested=10 actual=21
2026/01/27 17:54:07 INFO Narrator: Script rescue successful original=21 rescued=2
--- PASS: TestAIService_GenerateNarrative_RescueAvoidance (0.00s)
    --- PASS: TestAIService_GenerateNarrative_RescueAvoidance/No_Rescue_when_within_buffer (0.00s)
    --- PASS: TestAIService_GenerateNarrative_RescueAvoidance/Rescue_triggered_when_significantly_over (0.00s)
=== RUN   TestAIService_ExtractTitleFromScript
=== RUN   TestAIService_ExtractTitleFromScript/Standard_Title
=== RUN   TestAIService_ExtractTitleFromScript/Markdown_Bold_Title
=== RUN   TestAIService_ExtractTitleFromScript/Case_Insensitive_Title
=== RUN   TestAIService_ExtractTitleFromScript/No_Title
=== RUN   TestAIService_ExtractTitleFromScript/Title_Only
=== RUN   TestAIService_ExtractTitleFromScript/Indented_Title
=== RUN   TestAIService_ExtractTitleFromScript/Title_with_asterisk_suffix
--- PASS: TestAIService_ExtractTitleFromScript (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Standard_Title (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Markdown_Bold_Title (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Case_Insensitive_Title (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/No_Title (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Title_Only (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Indented_Title (0.00s)
    --- PASS: TestAIService_ExtractTitleFromScript/Title_with_asterisk_suffix (0.00s)
=== RUN   TestAIService_PlayImage
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=screenshot poi_id="" queue_len=1
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="Screenshot Analysis" priority=true queue_len=1
2026/01/27 17:54:07 INFO Narrator: Narration stats type=screenshot name="Screenshot Analysis" id=screenshot requested_len=50 words=2 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_PlayImage (0.50s)
=== RUN   TestAIService_PlayImage_RenderError
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=screenshot poi_id="" queue_len=1
2026/01/27 17:54:07 ERROR Narrator: Failed to render screenshot prompt error="template: no template \"narrator/screenshot.tmpl\" associated with template \"root\""
--- PASS: TestAIService_PlayImage_RenderError (0.10s)
=== RUN   TestCalculateNavInstruction
=== RUN   TestCalculateNavInstruction/Ground_<_4.5km_(Silence)
=== RUN   TestCalculateNavInstruction/Ground_>=_4.5km_(Cardinal_+_Dist)
=== RUN   TestCalculateNavInstruction/Ground_>=_4.5km_(Imperial)
=== RUN   TestCalculateNavInstruction/Airborne_<_4.5km_(Straight_Ahead)
=== RUN   TestCalculateNavInstruction/Airborne_<_4.5km_(On_Right)
=== RUN   TestCalculateNavInstruction/Airborne_<_4.5km_(On_Left)
=== RUN   TestCalculateNavInstruction/Airborne_>=_4.5km_(Clock_12)
=== RUN   TestCalculateNavInstruction/Airborne_>=_4.5km_(Clock_3)
--- PASS: TestCalculateNavInstruction (0.00s)
    --- PASS: TestCalculateNavInstruction/Ground_<_4.5km_(Silence) (0.00s)
    --- PASS: TestCalculateNavInstruction/Ground_>=_4.5km_(Cardinal_+_Dist) (0.00s)
    --- PASS: TestCalculateNavInstruction/Ground_>=_4.5km_(Imperial) (0.00s)
    --- PASS: TestCalculateNavInstruction/Airborne_<_4.5km_(Straight_Ahead) (0.00s)
    --- PASS: TestCalculateNavInstruction/Airborne_<_4.5km_(On_Right) (0.00s)
    --- PASS: TestCalculateNavInstruction/Airborne_<_4.5km_(On_Left) (0.00s)
    --- PASS: TestCalculateNavInstruction/Airborne_>=_4.5km_(Clock_12) (0.00s)
    --- PASS: TestCalculateNavInstruction/Airborne_>=_4.5km_(Clock_3) (0.00s)
=== RUN   TestHumanRound
--- PASS: TestHumanRound (0.00s)
=== RUN   TestCapitalizeStart
--- PASS: TestCapitalizeStart (0.00s)
=== RUN   TestAIService_RescueScript
--- PASS: TestAIService_RescueScript (0.00s)
=== RUN   TestAIService_PlayPOI_Constraints
2026/01/27 17:54:07 INFO Narrator: Manual play requested poi_id=Q123 enqueue_if_busy=false
2026/01/27 17:54:07 INFO Narrator: Promoting item in queue poi_id=Q123
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=poi poi_id=Q123 queue_len=1
2026/01/27 17:54:07 INFO Narrator: Automated play triggering poi_id=Q456
2026/01/27 17:54:07 INFO Narrator: Skipping auto-play (priority queue not empty)
--- PASS: TestAIService_PlayPOI_Constraints (0.00s)
=== RUN   TestAIService_QueueManagement
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title=Auto priority=false queue_len=1
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title=Manual priority=true queue_len=2
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=1
2026/01/27 17:54:07 INFO Narrator: Session reset (teleport/new flight detected)
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=1
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=2
2026/01/27 17:54:07 INFO Narrator: Promoting item in queue poi_id=Q2
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=poi poi_id=Q3 queue_len=1
--- PASS: TestAIService_QueueManagement (0.00s)
=== RUN   TestAIService_CanEnqueue
--- PASS: TestAIService_CanEnqueue (0.00s)
=== RUN   TestAIService_StateGetters
--- PASS: TestAIService_StateGetters (0.00s)
=== RUN   TestAIService_StateChecks
--- PASS: TestAIService_StateChecks (0.00s)
=== RUN   TestAIService_Replay
2026/01/27 17:54:07 INFO Narrator: Replaying last POI title="Test POI"
2026/01/27 17:54:07 INFO Narrator: Replaying last Essay title=""
--- PASS: TestAIService_Replay (0.00s)
=== RUN   TestAIService_Cooldown
2026/01/27 17:54:07 INFO Narrator: Skip cooldown requested
--- PASS: TestAIService_Cooldown (0.00s)
=== RUN   TestAIService_PlaybackDetails
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="" priority=false queue_len=1
--- PASS: TestAIService_PlaybackDetails (0.00s)
=== RUN   TestAIService_StatsAndLatency
--- PASS: TestAIService_StatsAndLatency (0.00s)
=== RUN   TestAIService_NarratedCount
--- PASS: TestAIService_NarratedCount (0.00s)
=== RUN   TestAIService_PlayPOI
=== RUN   TestAIService_PlayPOI/Happy_Path
2026/01/27 17:54:07 INFO AI Narrator service started
2026/01/27 17:54:07 INFO Narrator: Manual play requested poi_id=Q1 enqueue_if_busy=false
2026/01/27 17:54:07 INFO Narrator: Promoting item in queue poi_id=Q1
2026/01/27 17:54:07 INFO GenerationQueue: Enqueued job type=poi poi_id=Q1 queue_len=1
2026/01/27 17:54:07 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 INFO PlaybackQueue: Enqueued narrative title="Test POI" priority=true queue_len=1
2026/01/27 17:54:07 INFO Narrator: Narration stats type=poi name="Test POI" id=Q1 requested_len=200 words=2 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:07 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:07 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_PlayPOI/POI_Not_Found
2026/01/27 17:54:08 INFO AI Narrator service started
2026/01/27 17:54:08 INFO Narrator: Manual play requested poi_id=QMISSING enqueue_if_busy=false
2026/01/27 17:54:08 INFO Narrator: Promoting item in queue poi_id=QMISSING
2026/01/27 17:54:08 INFO GenerationQueue: Enqueued job type=poi poi_id=QMISSING queue_len=1
2026/01/27 17:54:08 ERROR Narrator: Priority job failed - POI not found poi_id=QMISSING
=== RUN   TestAIService_PlayPOI/LLM_Failure
2026/01/27 17:54:08 INFO AI Narrator service started
2026/01/27 17:54:08 INFO Narrator: Manual play requested poi_id=Q2 enqueue_if_busy=false
2026/01/27 17:54:08 INFO Narrator: Promoting item in queue poi_id=Q2
2026/01/27 17:54:08 INFO GenerationQueue: Enqueued job type=poi poi_id=Q2 queue_len=1
2026/01/27 17:54:08 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 ERROR Narrator: Priority generation failed type=poi error="LLM generation failed: llm fail"
=== RUN   TestAIService_PlayPOI/TTS_Failure
2026/01/27 17:54:08 INFO AI Narrator service started
2026/01/27 17:54:08 INFO Narrator: Manual play requested poi_id=Q3 enqueue_if_busy=false
2026/01/27 17:54:08 INFO Narrator: Promoting item in queue poi_id=Q3
2026/01/27 17:54:08 INFO GenerationQueue: Enqueued job type=poi poi_id=Q3 queue_len=1
2026/01/27 17:54:08 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 ERROR Narrator: TTS synthesis failed error="tts fail"
2026/01/27 17:54:08 ERROR Narrator: Priority generation failed type=poi error="TTS synthesis failed: tts fail"
=== RUN   TestAIService_PlayPOI/Audio_Failure
2026/01/27 17:54:08 INFO AI Narrator service started
2026/01/27 17:54:08 INFO Narrator: Manual play requested poi_id=Q4 enqueue_if_busy=false
2026/01/27 17:54:08 INFO Narrator: Promoting item in queue poi_id=Q4
2026/01/27 17:54:08 INFO GenerationQueue: Enqueued job type=poi poi_id=Q4 queue_len=1
2026/01/27 17:54:08 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 INFO PlaybackQueue: Enqueued narrative title=P4 priority=true queue_len=1
2026/01/27 17:54:08 ERROR Narrator: Queue playback failed, trying next title=P4 error="audio playback failed: audio fail"
=== RUN   TestAIService_PlayPOI/Wikipedia_Fetch
2026/01/27 17:54:08 INFO AI Narrator service started
2026/01/27 17:54:08 INFO Narrator: Manual play requested poi_id=QWiki enqueue_if_busy=false
2026/01/27 17:54:08 INFO Narrator: Promoting item in queue poi_id=QWiki
2026/01/27 17:54:08 INFO GenerationQueue: Enqueued job type=poi poi_id=QWiki queue_len=1
2026/01/27 17:54:08 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""

--- [WP PROSE START] ---
Script for Wiki POI
--- [WP PROSE END] ---

2026/01/27 17:54:08 INFO PlaybackQueue: Enqueued narrative title="Wiki POI" priority=true queue_len=1
2026/01/27 17:54:08 INFO Narrator: Narration stats type=poi name="Wiki POI" id=QWiki requested_len=200 words=2 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:08 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:08 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_PlayPOI (1.20s)
    --- PASS: TestAIService_PlayPOI/Happy_Path (0.20s)
    --- PASS: TestAIService_PlayPOI/POI_Not_Found (0.20s)
    --- PASS: TestAIService_PlayPOI/LLM_Failure (0.20s)
    --- PASS: TestAIService_PlayPOI/TTS_Failure (0.20s)
    --- PASS: TestAIService_PlayPOI/Audio_Failure (0.20s)
    --- PASS: TestAIService_PlayPOI/Wikipedia_Fetch (0.20s)
=== RUN   TestAIService_ContextAndNav_V2
=== RUN   TestAIService_ContextAndNav_V2/With_Nav_Instruction
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=QNav enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=QNav
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=QNav queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=QNav priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=QNav id=QNav requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_ContextAndNav_V2/With_Recent_POIs
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=QCurrent enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=QCurrent
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=QCurrent queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=QCurrent priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=QCurrent id=QCurrent requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_ContextAndNav_V2 (0.04s)
    --- PASS: TestAIService_ContextAndNav_V2/With_Nav_Instruction (0.02s)
    --- PASS: TestAIService_ContextAndNav_V2/With_Recent_POIs (0.02s)
=== RUN   TestAIService_Lifecycle
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO AI Narrator service stopped
--- PASS: TestAIService_Lifecycle (0.00s)
=== RUN   TestAIService_NavUnits
=== RUN   TestAIService_NavUnits/Imperial_Default_(>1_mile)
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=Q8080 enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=Q8080
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=Q8080 queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title="" priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name="" id="" requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_NavUnits/Metric_(>1_km)
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=Q8080 enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=Q8080
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=Q8080 queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title="" priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name="" id="" requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_NavUnits/Hybrid_->_Metric
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=Q8080 enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=Q8080
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=Q8080 queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title="" priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name="" id="" requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_NavUnits (0.16s)
    --- PASS: TestAIService_NavUnits/Imperial_Default_(>1_mile) (0.05s)
    --- PASS: TestAIService_NavUnits/Metric_(>1_km) (0.05s)
    --- PASS: TestAIService_NavUnits/Hybrid_->_Metric (0.05s)
=== RUN   TestAIService_BeaconCleanup
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO AI Narrator service started
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=Q12345 enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=Q12345
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=Q12345 queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=Q1 priority=true queue_len=1
2026/01/27 17:54:09 ERROR Narrator: Queue playback failed, trying next title=Q1 error="audio playback failed: fail"
--- PASS: TestAIService_BeaconCleanup (0.05s)
=== RUN   TestAIService_GeneratePlay
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=QGen id=QGen requested_len=0 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_GeneratePlay (0.00s)
=== RUN   TestAIService_UpdateTripSummary
=== RUN   TestAIService_UpdateTripSummary/First_Summary
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
=== RUN   TestAIService_UpdateTripSummary/Summary_Update
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
--- PASS: TestAIService_UpdateTripSummary (0.00s)
    --- PASS: TestAIService_UpdateTripSummary/First_Summary (0.00s)
    --- PASS: TestAIService_UpdateTripSummary/Summary_Update (0.00s)
=== RUN   TestAIService_LatencyTracking
--- PASS: TestAIService_LatencyTracking (0.05s)
=== RUN   TestAIService_PipelineFlow
=== RUN   TestAIService_PipelineFlow/Happy_Path:_Consumes_Staged_Constraint
2026/01/27 17:54:09 INFO Narrator: Pipeline preparing next narrative poi_id=QStaged
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=POI priority=false queue_len=1
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=QStaged enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=QStaged
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=POI id=QStaged requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_PipelineFlow/Mismatch:_Staged_A,_Play_B_->_Ignores_Stage,_Generates_B
2026/01/27 17:54:09 INFO Narrator: Pipeline preparing next narrative poi_id=QStaged
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=POI priority=false queue_len=1
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=QOther enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=QOther
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=QOther queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=POI priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=POI id=QStaged requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
=== RUN   TestAIService_PipelineFlow/No_Staged_Data_->_Generates_Fresh
2026/01/27 17:54:09 INFO Narrator: Manual play requested poi_id=QFresh enqueue_if_busy=false
2026/01/27 17:54:09 INFO Narrator: Promoting item in queue poi_id=QFresh
2026/01/27 17:54:09 INFO GenerationQueue: Enqueued job type=poi poi_id=QFresh queue_len=1
2026/01/27 17:54:09 WARN Narrator: Failed to load units template system=hybrid error="template: no template \"units/hybrid.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 INFO PlaybackQueue: Enqueued narrative title=POI priority=true queue_len=1
2026/01/27 17:54:09 INFO Narrator: Narration stats type=poi name=POI id=QFresh requested_len=200 words=1 audio_duration=10s acc_gen_time=0.0s next_prediction=60.0s
2026/01/27 17:54:09 WARN Narrator: Failed to render TTS template, using fallback template=tts/edge-tts.tmpl error="template: no template \"tts/edge-tts.tmpl\" associated with template \"root\""
2026/01/27 17:54:09 ERROR Narrator: Failed to render summary update template error="template: no template \"narrator/summary_update.tmpl\" associated with template \"root\""
--- PASS: TestAIService_PipelineFlow (0.30s)
    --- PASS: TestAIService_PipelineFlow/Happy_Path:_Consumes_Staged_Constraint (0.10s)
    --- PASS: TestAIService_PipelineFlow/Mismatch:_Staged_A,_Play_B_->_Ignores_Stage,_Generates_B (0.10s)
    --- PASS: TestAIService_PipelineFlow/No_Staged_Data_->_Generates_Fresh (0.10s)
=== RUN   TestAIService_ScriptValidation
2026/01/27 17:54:09 WARN Narrator: Script exceeded limit, attempting rescue requested=200 actual=1000
2026/01/27 17:54:09 ERROR Narrator: Script rescue failed, using original error="LLM could not extract valid script"
--- PASS: TestAIService_ScriptValidation (0.00s)
=== RUN   TestAllProductionTemplatesExecuteSuccessfully
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/category/aerodrome.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/category/city.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/category/nature.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/category/water.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/context/accent.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/context/rescue_script.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/context/thumbnail_selector.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/context/wikidata.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/border.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/debrief.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/essay.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/readout.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/screenshot.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/script.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/narrator/summary_update.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/tts/azure.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/tts/edge-tts.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/tts/fish-audio.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/units/hybrid.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/units/imperial.tmpl
=== RUN   TestAllProductionTemplatesExecuteSuccessfully/units/metric.tmpl
--- PASS: TestAllProductionTemplatesExecuteSuccessfully (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/category/aerodrome.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/category/city.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/category/nature.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/category/water.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/context/accent.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/context/rescue_script.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/context/thumbnail_selector.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/context/wikidata.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/border.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/debrief.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/essay.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/readout.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/screenshot.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/script.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/narrator/summary_update.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/tts/azure.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/tts/edge-tts.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/tts/fish-audio.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/units/hybrid.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/units/imperial.tmpl (0.00s)
    --- PASS: TestAllProductionTemplatesExecuteSuccessfully/units/metric.tmpl (0.00s)
=== RUN   TestAIService_TTSFallback
2026/01/27 17:54:09 WARN Narrator: Activating edge-tts fallback for this session
--- PASS: TestAIService_TTSFallback (0.00s)
=== RUN   TestAIService_SkipCooldown
2026/01/27 17:54:09 INFO Narrator: Skip cooldown requested
--- PASS: TestAIService_SkipCooldown (0.00s)
=== RUN   TestStubService_Lifecycle
2026/01/27 17:54:09 INFO Narrator stub service started
2026/01/27 17:54:09 INFO Narrator stub service stopped
--- PASS: TestStubService_Lifecycle (0.00s)
=== RUN   TestStubService_PlayPOI
2026/01/27 17:54:09 INFO Narrator stub: manual play requested poi_id=Q1
--- PASS: TestStubService_PlayPOI (0.00s)
=== RUN   TestStubService_PlayEssay
2026/01/27 17:54:09 INFO Narrator stub: essay play requested
--- PASS: TestStubService_PlayEssay (0.00s)
=== RUN   TestStubService_Cooldown
--- PASS: TestStubService_Cooldown (0.00s)
=== RUN   TestStubService_Stats
--- PASS: TestStubService_Stats (0.00s)
=== RUN   TestStubService_Getters
--- PASS: TestStubService_Getters (0.00s)
=== RUN   TestGenerateFlightStatusSentence
=== RUN   TestGenerateFlightStatusSentence/Sitting_on_Ground
=== RUN   TestGenerateFlightStatusSentence/Taxiing_on_Ground
=== RUN   TestGenerateFlightStatusSentence/Flying_Low_Rounding
=== RUN   TestGenerateFlightStatusSentence/Flying_High_Rounding
=== RUN   TestGenerateFlightStatusSentence/Flying_High_Rounding_Up
--- PASS: TestGenerateFlightStatusSentence (0.00s)
    --- PASS: TestGenerateFlightStatusSentence/Sitting_on_Ground (0.00s)
    --- PASS: TestGenerateFlightStatusSentence/Taxiing_on_Ground (0.00s)
    --- PASS: TestGenerateFlightStatusSentence/Flying_Low_Rounding (0.00s)
    --- PASS: TestGenerateFlightStatusSentence/Flying_High_Rounding (0.00s)
    --- PASS: TestGenerateFlightStatusSentence/Flying_High_Rounding_Up (0.00s)
=== RUN   TestDetermineSkewStrategy
=== RUN   TestDetermineSkewStrategy/nil_POI_returns_uniform
=== RUN   TestDetermineSkewStrategy/on_ground_always_returns_max_skew
=== RUN   TestDetermineSkewStrategy/on_ground_with_low_score_still_returns_max_skew
=== RUN   TestDetermineSkewStrategy/airborne_lone_wolf_(no_rivals)_returns_max_skew
=== RUN   TestDetermineSkewStrategy/airborne_with_competition_returns_min_skew
=== RUN   TestDetermineSkewStrategy/airborne_with_many_rivals_returns_min_skew
=== RUN   TestDetermineSkewStrategy/airborne_low_score_no_rivals_returns_max_skew
--- PASS: TestDetermineSkewStrategy (0.00s)
    --- PASS: TestDetermineSkewStrategy/nil_POI_returns_uniform (0.00s)
    --- PASS: TestDetermineSkewStrategy/on_ground_always_returns_max_skew (0.00s)
    --- PASS: TestDetermineSkewStrategy/on_ground_with_low_score_still_returns_max_skew (0.00s)
    --- PASS: TestDetermineSkewStrategy/airborne_lone_wolf_(no_rivals)_returns_max_skew (0.00s)
    --- PASS: TestDetermineSkewStrategy/airborne_with_competition_returns_min_skew (0.00s)
    --- PASS: TestDetermineSkewStrategy/airborne_with_many_rivals_returns_min_skew (0.00s)
    --- PASS: TestDetermineSkewStrategy/airborne_low_score_no_rivals_returns_max_skew (0.00s)
=== RUN   TestNarrator_Integration
    integration_test.go:66: Successfully rendered template. Preview:
        You are an expert for the region Ile-de-France in France.
        
        You are creating a script for a tour gu...
--- PASS: TestNarrator_Integration (0.00s)
PASS
ok  	phileasgo/pkg/narrator	(cached)
